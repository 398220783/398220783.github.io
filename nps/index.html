<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>使用说明！</title>
<body>
    <article class="markdown-section" id="main"><div style="overflow: auto"><p style="float: right"><a style="text-decoration: underline; cursor: pointer" onclick="EditOnGithubPlugin.onClick(event)">在github上编辑</a></p></div><h1 id="基本使用"><a href="#/use?id=%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8" data-id="基本使用" class="anchor"><span>基本使用</span></a></h1><h2 id="无配置文件模式"><a href="#/use?id=%e6%97%a0%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e6%a8%a1%e5%bc%8f" data-id="无配置文件模式" class="anchor"><span>无配置文件模式</span></a></h2><p>此模式的各种配置在服务端web管理中完成,客户端除运行一条命令外无需任何其他设置</p><pre v-pre="" data-lang=""><code class="lang-"> ./npc -server=ip:port -vkey=web界面中显示的密钥</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><h2 id="注册到系统服务开机启动、守护进程"><a href="#/use?id=%e6%b3%a8%e5%86%8c%e5%88%b0%e7%b3%bb%e7%bb%9f%e6%9c%8d%e5%8a%a1%e5%bc%80%e6%9c%ba%e5%90%af%e5%8a%a8%e3%80%81%e5%ae%88%e6%8a%a4%e8%bf%9b%e7%a8%8b" data-id="注册到系统服务开机启动、守护进程" class="anchor"><span>注册到系统服务(开机启动、守护进程)</span></a></h2><p>对于linux、darwin</p><ul><li>注册：<code>sudo ./npc install 其他参数（例如-server=xx -vkey=xx或者-config=xxx）</code></li><li>启动：<code>sudo npc start</code></li><li>停止：<code>sudo npc stop</code></li><li>如果需要更换命令内容需要先卸载<code>./npc uninstall</code>，再重新注册</li></ul><p>对于windows，使用管理员身份运行cmd</p><ul><li>注册：<code>npc.exe install 其他参数（例如-server=xx -vkey=xx或者-config=xxx）</code></li><li>启动：<code>npc.exe start</code></li><li>停止：<code>npc.exe stop</code></li><li>如果需要更换命令内容需要先卸载<code>npc.exe uninstall</code>，再重新注册</li><li>如果需要当客户端退出时自动重启客户端，请按照如图所示配置
<img src="https://github.com/ehang-io/nps/blob/master/docs/windows_client_service_configuration.png?raw=true" data-origin="https://github.com/ehang-io/nps/blob/master/docs/windows_client_service_configuration.png?raw=true" alt="image"></li></ul><p>注册到服务后，日志文件windows位于当前目录下，linux和darwin位于/var/log/npc.log</p><h2 id="客户端更新"><a href="#/use?id=%e5%ae%a2%e6%88%b7%e7%ab%af%e6%9b%b4%e6%96%b0" data-id="客户端更新" class="anchor"><span>客户端更新</span></a></h2><p>首先进入到对于的客户端二进制文件目录</p><p>请首先执行<code>sudo npc stop</code>或者<code>npc.exe stop</code>停止运行，然后</p><p>对于linux</p><pre v-pre="" data-lang="shell"><code class="lang-shell"> sudo npc-update update</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>对于windows</p><pre v-pre="" data-lang="shell"><code class="lang-shell">npc-update.exe update</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>更新完成后，执行执行<code>sudo npc start</code>或者<code>npc.exe start</code>重新运行即可完成升级</p><p>如果无法更新成功，可以直接自行下载releases压缩包然后覆盖原有的npc二进制文件</p><h2 id="配置文件模式"><a href="#/use?id=%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e6%a8%a1%e5%bc%8f" data-id="配置文件模式" class="anchor"><span>配置文件模式</span></a></h2><p>此模式使用nps的公钥或者客户端私钥验证，各种配置在客户端完成，同时服务端web也可以进行管理</p><pre v-pre="" data-lang=""><code class="lang-"> ./npc -config=npc配置文件路径</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><h2 id="配置文件说明"><a href="#/use?id=%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e8%af%b4%e6%98%8e" data-id="配置文件说明" class="anchor"><span>配置文件说明</span></a></h2><p><a href="https://github.com/ehang-io/nps/tree/master/conf/npc.conf" target="_blank" rel="noopener">示例配置文件</a></p><h4 id="全局配置"><a href="#/use?id=%e5%85%a8%e5%b1%80%e9%85%8d%e7%bd%ae" data-id="全局配置" class="anchor"><span>全局配置</span></a></h4><pre v-pre="" data-lang="ini"><code class="lang-ini">[common]
server_addr=1.1.1.1:8024
conn_type=tcp
vkey=123
username=111
password=222
compress=true
crypt=true
rate_limit=10000
flow_limit=100
remark=test
max_conn=10
#pprof_addr=0.0.0.0:9999</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><table>
<thead>
<tr>
<th>项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>server_addr</td>
<td>服务端ip/域名:port</td>
</tr>
<tr>
<td>conn_type</td>
<td>与服务端通信模式(tcp或kcp)</td>
</tr>
<tr>
<td>vkey</td>
<td>服务端配置文件中的密钥(非web)</td>
</tr>
<tr>
<td>username</td>
<td>socks5或http(s)密码保护用户名(可忽略)</td>
</tr>
<tr>
<td>password</td>
<td>socks5或http(s)密码保护密码(可忽略)</td>
</tr>
<tr>
<td>compress</td>
<td>是否压缩传输(true或false或忽略)</td>
</tr>
<tr>
<td>crypt</td>
<td>是否加密传输(true或false或忽略)</td>
</tr>
<tr>
<td>rate_limit</td>
<td>速度限制，可忽略</td>
</tr>
<tr>
<td>flow_limit</td>
<td>流量限制，可忽略</td>
</tr>
<tr>
<td>remark</td>
<td>客户端备注，可忽略</td>
</tr>
<tr>
<td>max_conn</td>
<td>最大连接数，可忽略</td>
</tr>
<tr>
<td>pprof_addr</td>
<td>debug pprof ip:port</td>
</tr>
</tbody></table>
<h4 id="域名代理"><a href="#/use?id=%e5%9f%9f%e5%90%8d%e4%bb%a3%e7%90%86" data-id="域名代理" class="anchor"><span>域名代理</span></a></h4><pre v-pre="" data-lang="ini"><code class="lang-ini">[common]
server_addr=1.1.1.1:8024
vkey=123
[web1]
host=a.proxy.com
target_addr=127.0.0.1:8080,127.0.0.1:8082
host_change=www.proxy.com
header_set_proxy=nps</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><table>
<thead>
<tr>
<th>项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>web1</td>
<td>备注</td>
</tr>
<tr>
<td>host</td>
<td>域名(http</td>
</tr>
<tr>
<td>target_addr</td>
<td>内网目标，负载均衡时多个目标，逗号隔开</td>
</tr>
<tr>
<td>host_change</td>
<td>请求host修改</td>
</tr>
<tr>
<td>header_xxx</td>
<td>请求header修改或添加，header_proxy表示添加header proxy:nps</td>
</tr>
</tbody></table>
<h4 id="tcp隧道模式"><a href="#/use?id=tcp%e9%9a%a7%e9%81%93%e6%a8%a1%e5%bc%8f" data-id="tcp隧道模式" class="anchor"><span>tcp隧道模式</span></a></h4><pre v-pre="" data-lang="ini"><code class="lang-ini">[common]
server_addr=1.1.1.1:8024
vkey=123
[tcp]
mode=tcp
target_addr=127.0.0.1:8080
server_port=9001</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><table>
<thead>
<tr>
<th>项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>mode</td>
<td>tcp</td>
</tr>
<tr>
<td>server_port</td>
<td>在服务端的代理端口</td>
</tr>
<tr>
<td>tartget_addr</td>
<td>内网目标</td>
</tr>
</tbody></table>
<h4 id="udp隧道模式"><a href="#/use?id=udp%e9%9a%a7%e9%81%93%e6%a8%a1%e5%bc%8f" data-id="udp隧道模式" class="anchor"><span>udp隧道模式</span></a></h4><pre v-pre="" data-lang="ini"><code class="lang-ini">[common]
server_addr=1.1.1.1:8024
vkey=123
[udp]
mode=udp
target_addr=127.0.0.1:8080
server_port=9002</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><table>
<thead>
<tr>
<th>项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>mode</td>
<td>udp</td>
</tr>
<tr>
<td>server_port</td>
<td>在服务端的代理端口</td>
</tr>
<tr>
<td>target_addr</td>
<td>内网目标</td>
</tr>
</tbody></table>
<h4 id="http代理模式"><a href="#/use?id=http%e4%bb%a3%e7%90%86%e6%a8%a1%e5%bc%8f" data-id="http代理模式" class="anchor"><span>http代理模式</span></a></h4><pre v-pre="" data-lang="ini"><code class="lang-ini">[common]
server_addr=1.1.1.1:8024
vkey=123
[http]
mode=httpProxy
server_port=9003</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><table>
<thead>
<tr>
<th>项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>mode</td>
<td>httpProxy</td>
</tr>
<tr>
<td>server_port</td>
<td>在服务端的代理端口</td>
</tr>
</tbody></table>
<h4 id="socks5代理模式"><a href="#/use?id=socks5%e4%bb%a3%e7%90%86%e6%a8%a1%e5%bc%8f" data-id="socks5代理模式" class="anchor"><span>socks5代理模式</span></a></h4><pre v-pre="" data-lang="ini"><code class="lang-ini">[common]
server_addr=1.1.1.1:8024
vkey=123
[socks5]
mode=socks5
server_port=9004
multi_account=multi_account.conf</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><table>
<thead>
<tr>
<th>项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>mode</td>
<td>socks5</td>
</tr>
<tr>
<td>server_port</td>
<td>在服务端的代理端口</td>
</tr>
<tr>
<td>multi_account</td>
<td>socks5多账号配置文件（可选),配置后使用basic_username和basic_password无法通过认证</td>
</tr>
</tbody></table>
<h4 id="私密代理模式"><a href="#/use?id=%e7%a7%81%e5%af%86%e4%bb%a3%e7%90%86%e6%a8%a1%e5%bc%8f" data-id="私密代理模式" class="anchor"><span>私密代理模式</span></a></h4><pre v-pre="" data-lang="ini"><code class="lang-ini">[common]
server_addr=1.1.1.1:8024
vkey=123
[secret_ssh]
mode=secret
password=ssh2
target_addr=10.1.50.2:22</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><table>
<thead>
<tr>
<th>项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>mode</td>
<td>secret</td>
</tr>
<tr>
<td>password</td>
<td>唯一密钥</td>
</tr>
<tr>
<td>target_addr</td>
<td>内网目标</td>
</tr>
</tbody></table>
<h4 id="p2p代理模式"><a href="#/use?id=p2p%e4%bb%a3%e7%90%86%e6%a8%a1%e5%bc%8f" data-id="p2p代理模式" class="anchor"><span>p2p代理模式</span></a></h4><pre v-pre="" data-lang="ini"><code class="lang-ini">[common]
server_addr=1.1.1.1:8024
vkey=123
[p2p_ssh]
mode=p2p
password=ssh2
target_addr=10.1.50.2:22</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><table>
<thead>
<tr>
<th>项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>mode</td>
<td>p2p</td>
</tr>
<tr>
<td>password</td>
<td>唯一密钥</td>
</tr>
<tr>
<td>target_addr</td>
<td>内网目标</td>
</tr>
</tbody></table>
<h4 id="文件访问模式"><a href="#/use?id=%e6%96%87%e4%bb%b6%e8%ae%bf%e9%97%ae%e6%a8%a1%e5%bc%8f" data-id="文件访问模式" class="anchor"><span>文件访问模式</span></a></h4><p>利用nps提供一个公网可访问的本地文件服务，此模式仅客户端使用配置文件模式方可启动</p><pre v-pre="" data-lang="ini"><code class="lang-ini">[common]
server_addr=1.1.1.1:8024
vkey=123
[file]
mode=file
server_port=9100
local_path=/tmp/
strip_pre=/web/</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><table>
<thead>
<tr>
<th>项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>mode</td>
<td>file</td>
</tr>
<tr>
<td>server_port</td>
<td>服务端开启的端口</td>
</tr>
<tr>
<td>local_path</td>
<td>本地文件目录</td>
</tr>
<tr>
<td>strip_pre</td>
<td>前缀</td>
</tr>
</tbody></table>
<p>对于<code>strip_pre</code>，访问公网<code>ip:9100/web/</code>相当于访问<code>/tmp/</code>目录</p><h4 id="断线重连"><a href="#/use?id=%e6%96%ad%e7%ba%bf%e9%87%8d%e8%bf%9e" data-id="断线重连" class="anchor"><span>断线重连</span></a></h4><pre v-pre="" data-lang="ini"><code class="lang-ini">[common]
auto_reconnection=true</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre></article>
</body>
</html>
